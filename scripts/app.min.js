"use strict";Blockly.Blocks.robotica_motor={init:function(){this.appendValueInput("leftWheel").setCheck("Number").appendField("Rueda izquierda"),this.appendValueInput("rightWheel").setCheck("Number").appendField("Rueda derecha"),this.appendValueInput("duration").setCheck("Number").appendField("Duración"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(65),this.setTooltip("Hacer que el robot se mueva con determinada potencia en cada rueda durante el tiempo definido."),this.setHelpUrl("http://www.example.com/")}},Blockly.JavaScript.robotica_motor=function(e){return"motor("+Blockly.JavaScript.valueToCode(e,"leftWheel",Blockly.JavaScript.ORDER_ATOMIC)+", "+Blockly.JavaScript.valueToCode(e,"rightWheel",Blockly.JavaScript.ORDER_ATOMIC)+", "+Blockly.JavaScript.valueToCode(e,"duration",Blockly.JavaScript.ORDER_ATOMIC)+");\n"},Blockly.Arduino.robotica_motor=function(e){return"motor("+Blockly.JavaScript.valueToCode(e,"leftWheel",Blockly.JavaScript.ORDER_ATOMIC)+", "+Blockly.JavaScript.valueToCode(e,"rightWheel",Blockly.JavaScript.ORDER_ATOMIC)+", "+Blockly.JavaScript.valueToCode(e,"duration",Blockly.JavaScript.ORDER_ATOMIC)+");\n"},Blockly.Blocks.robotica_sensor={init:function(){this.setOutput(!0,Blockly.Types.NUMBER.output),this.appendDummyInput().appendField("Sensor").appendField(new Blockly.FieldDropdown([["Izquierda","left"],["Derecha","right"],["Adelante","front"]]),"Sensor"),this.setColour(65),this.setTooltip("Activa el sensor de proximidad en la dirección determinada."),this.setHelpUrl("http://www.example.com/")},getBlockType:function(){return Blockly.Types.NUMBER}},Blockly.JavaScript.robotica_sensor=function(e){return["sensor('"+e.getFieldValue("Sensor")+"')",Blockly.JavaScript.ORDER_ATOMIC]},Blockly.Arduino.robotica_sensor=function(e){return["sense("+e.getFieldValue("Sensor")+")",Blockly.JavaScript.ORDER_ATOMIC]},Blockly.Blocks.robotica_tracer_status={init:function(){this.appendValueInput("enable").setCheck("Boolean").appendField("Traza habilitada"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(65),this.setTooltip("Si es verdadero, entonces habilita la traza."),this.setHelpUrl("http://www.example.com/")}},Blockly.JavaScript.robotica_tracer_status=function(e){return"tracer("+Blockly.JavaScript.valueToCode(e,"enable",Blockly.JavaScript.ORDER_ATOMIC)+");\n"},Blockly.Arduino.robotica_tracer_status=function(e){return""},Blockly.Blocks.robotica_tracer_colour={init:function(){this.appendDummyInput().appendField("Color de traza").appendField(new Blockly.FieldColour("#ff0000"),"trace_colour"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(65),this.setTooltip("Define el color de la traza."),this.setHelpUrl("http://www.example.com/")}},Blockly.JavaScript.robotica_tracer_colour=function(e){return"tracer_colour('"+e.getFieldValue("trace_colour")+"');\n"},Blockly.Arduino.robotica_tracer_colour=function(e){return""},Blockly.Blocks.console_log={init:function(){this.appendValueInput("text").setCheck(null).appendField("Texto"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(20),this.setTooltip(""),this.setHelpUrl("http://www.example.com/")}},Blockly.JavaScript.console_log=function(e){return["console_log("+Blockly.JavaScript.valueToCode(e,"text",Blockly.JavaScript.ORDER_ATOMIC)+");\n",Blockly.JavaScript.ORDER_ATOMIC]},String.prototype.format=String.prototype.format||function(){var e=this.toString();if(arguments.length){var t,o=typeof arguments[0],i="string"===o||"number"===o?Array.prototype.slice.call(arguments):arguments[0];for(t in i)e=e.replace(new RegExp("\\{"+t+"\\}","gi"),i[t])}return e},this.app=app||{},this.app.models=app.models||{},this.app.models.Blockly=Backbone.Model.extend({defaults:{},initialize:function(){},exportWorkspaceXml:function(){var e=Blockly.Xml.workspaceToDom(this.get("workspace"));return Blockly.Xml.domToPrettyText(e)},addWorkspaceOnChangeListener:function(e){this.get("workspace").addChangeListener(e)},removeWorkspaceOnChangeListener:function(e){this.get("workspace").removeChangeListener(e)},exportWorkspaceArduino:function(){var e=Blockly.Arduino.workspaceToCode(this.get("workspace")),t=/void setup\(.*\) \{([\s\S]*?)\}[\s\S]*void loop/,o=/void loop\(.*\) \{([\s\S]*?)\s\}$/,i=/([\s\S]*?)void setup()/,a=e.match(i)[1],n=e.match(t)[1],l=e.match(o)[1];return arduinoCode.format(a,n,l)},exportWorkspaceJavascript:function(){return Blockly.JavaScript.workspaceToCode(this.get("workspace"))},importWorkspaceXml:function(e){this.get("workspace").clear();var t=Blockly.Xml.textToDom(e);Blockly.Xml.domToWorkspace(t,this.get("workspace"))},codeIsEmpty:function(){var e=Blockly.JavaScript.workspaceToCode(this.get("workspace"));return!e||!e.trim().length},clearWorkspace:function(){this.get("workspace").clear()}}),this.app=app||{},this.app.models=app.models||{},this.app.models.FileSave=Backbone.Model.extend({defaults:{fileExtension:"",defaultFileName:"",extractCode:function(){}},initialize:function(){},downloadWithFileName:function(e){var t=this.get("extractCode")();this.saveTextAsFile(t,this.formatFileName(e,this.get("fileExtension")))},saveTextAsFile:function(e,t){var o=navigator.userAgent.match(/MSIE\s([\d.]+)/),i=navigator.userAgent.match(/Trident\/7.0/)&&navigator.userAgent.match(/rv:11/),a=navigator.userAgent.match(/Edge/g),n=o?o[1]:i?11:a?12:-1;if(o&&n<10)console.log("No blobs on IE ver < 10.");else{var l=new Blob([e],{type:"text/plain"});if(n>-1)window.navigator.msSaveBlob(l,t);else{var s=document.createElement("a");s.download=t,s.href=window.URL.createObjectURL(l),s.onclick=function(e){document.body.removeChild(e.target)},s.style.display="none",document.body.appendChild(s),s.click()}}},formatFileName:function(e,t){return((e=e||this.get("defaultFileName")+t).length<4||e.substr(e.length-4)!=t)&&(e+=t),e}}),this.app=app||{},this.app.models=app.models||{},this.app.models.Simulator=Backbone.Model.extend({initialize:function(){this.onWorkspaceChangeCallback=$.proxy(this.onWorkspaceChange,this)},enableSensorsHUD:function(){me.game.HUD.enableHUD()},disableSensorsHUD:function(){me.game.HUD.disableHUD()},onWorkspaceChange:function(e){e.type!=Blockly.Events.CHANGE&&e.type!=Blockly.Events.CREATE&&e.type!=Blockly.Events.DELETE||(me.execution.finish(),app.blocklyModel.removeWorkspaceOnChangeListener(this.onWorkspaceChangeCallback))},pause:function(e){me.execution.isRunning()&&(e(),me.execution.pause(),app.blocklyModel.addWorkspaceOnChangeListener(this.onWorkspaceChangeCallback))},stop:function(e){me.execution.hasFinished()||(e(),me.execution.finish(),me.state.change(me.state.PLAY))},run:function(e,t){if(me.execution.hasFinished()){var o=app.blocklyModel.exportWorkspaceJavascript();if(!o.length)return void module.notifyEmptyProgram();me.state.pause(),me.state.change(me.state.PLAY),me.execution.onCompleted=t,me.interpreter=this.get("interpreter").createInterpreter(o),me.state.resume()}me.execution.isPaused()&&app.blocklyModel.removeWorkspaceOnChangeListener(this.onWorkspaceChangeCallback),me.execution.isRunning()||(e(),me.execution.run())},changeMap:function(e){app.blocklyModel.clearWorkspace(),me.game.changeMap(e)},notifyEmptyProgram:_.throttle(function(){toastr.info("No hay código para ejecutar.","Programa vacío",{timeOut:2e3})},3e3,{trailing:!1}),notifySaturationLeftWheel:_.throttle(function(){this.notifySaturation("La potencia de la rueda izquierda está fuera del rango [-100, 100].")},3e3,{trailing:!1}),notifySaturationRightWheel:_.throttle(function(){this.notifySaturation("La potencia de la rueda derecha está fuera del rango [-100, 100].")},3e3,{trailing:!1}),notifySaturation:function(e){toastr.warning(e,"Potencia fuera de límite",{timeOut:2e3})}}),this.app=app||{},this.app.models=app.models||{},this.app.models.SimulatorInterpreter=Backbone.Model.extend({initialize:function(){},createInterpreter:function(e){return new Interpreter(e,this.initApi)},initApi:function(e,t){e.robotInstructions=new Array;e.setProperty(t,"sensor",e.createAsyncFunction(function(t,o){e.robotInstructions.push({action:"sensor",sensorName:t,sensorResultCallback:o})})),e.setProperty(t,"motor",e.createNativeFunction(function(t,o,i){return(t.data<-100||t.data>100)&&(t.data=Math.max(-100,Math.min(100,t.data)),app.simulatorModel.notifySaturationLeftWheel()),(o.data<-100||o.data>100)&&(o.data=Math.max(-100,Math.min(100,o.data)),app.simulatorModel.notifySaturationRightWheel()),e.createPrimitive(e.robotInstructions.push({action:"motor",leftWheel:t.data,rightWheel:o.data,duration:i.data}))})),e.setProperty(t,"console_log",e.createNativeFunction(function(t){return console.log("Console log: "),console.log(t.data),e.createPrimitive(null)})),e.setProperty(t,"tracer_colour",e.createNativeFunction(function(t){return e.robotInstructions.push({action:"tracer_colour",colour:t}),e.createPrimitive(null)})),e.setProperty(t,"tracer",e.createNativeFunction(function(t){return e.robotInstructions.push({action:"tracer_status",enabled:t}),e.createPrimitive(null)}))}}),this.app=app||{},this.app.views=app.views||{},app.views.AppView=Backbone.View.extend({initialize:function(){$.material.init(),this.$homeNavbarCollapseElement=this.$el.find("#home-navbar-collapse"),this.$homeContentElement=this.$el.find("#home-content"),this.$homeBlocklyWrapperElement=this.$el.find("#home-blockly-wrapper"),this.$homeSimulatorWrapperElement=this.$el.find("#home-simulator-wrapper"),this.$mapsModalElement=$("#maps-modal"),this.$stateIndicatorElement=$("#state-indicator"),this.setInitialLayoutMode(),this.$homeNavbarCollapseElement.on("shown.bs.collapse hidden.bs.collapse",app.blocklyView.forceBlocklySvgResize),this.$homeSimulatorWrapperElement.click($.proxy(this.toggleLayoutMode,this))},setInitialLayoutMode:function(){_.contains(["xs","sm"],this.getState())?this.setLayoutModeCollapsed():this.setLayoutModeExpanded()},setLayoutModeCollapsed:function(){this.$homeContentElement.removeClass("content-expanded"),this.$homeSimulatorWrapperElement.removeClass("simulator-expanded"),this.$homeBlocklyWrapperElement.removeClass("blockly-expanded"),this.$homeContentElement.addClass("content-collapsed"),this.$homeSimulatorWrapperElement.addClass("simulator-collapsed"),this.$homeBlocklyWrapperElement.addClass("blockly-collapsed"),app.simulatorView.enableSimulatorDragging(),app.simulatorView.onContainerResize(),app.blocklyView.onContainerResize()},setLayoutModeExpanded:function(){this.$homeContentElement.removeClass("content-collapsed"),this.$homeSimulatorWrapperElement.removeClass("simulator-collapsed"),this.$homeBlocklyWrapperElement.removeClass("blockly-collapsed"),this.$homeContentElement.addClass("content-expanded"),this.$homeSimulatorWrapperElement.addClass("simulator-expanded"),this.$homeBlocklyWrapperElement.addClass("blockly-expanded"),app.simulatorView.disableSimulatorDragging(),app.simulatorView.onContainerResize(),app.blocklyView.onContainerResize()},toggleLayoutMode:function(){this.$homeContentElement.hasClass("content-expanded")?this.setLayoutModeCollapsed():this.setLayoutModeExpanded()},getState:function(){return window.getComputedStyle(this.$stateIndicatorElement[0],":before").getPropertyValue("content").replace(/"/g,"")||"unknown"}}),this.app=app||{},this.app.views=app.views||{},this.app.views.Blockly=Backbone.View.extend({events:{"change #hidden-file-input":"onHiddenFileInputChange"},render:function(){var e={media:"assets/blockly/",sounds:!0,toolbox:document.getElementById("blockly-toolbox"),rtl:!1,collapse:!0,comments:!0,css:!0,disable:!0,grid:!1,maxBlocks:1/0,zoom:{controls:!0,wheel:!1,startScale:.8,maxScale:2,minScale:.2,scaleSpeed:1.2}};this.workspace=Blockly.inject("blockly-div",e),this.model.set("workspace",this.workspace),this.onContainerResize(),Blockly.JavaScript.INFINITE_LOOP_TRAP=null,Blockly.Blocks.math.HUE=35},initialize:function(){this.$hiddenFileInputElement=$("#hidden-file-input"),this.$blocklyDivElement=this.$el.find("#blockly-div"),this.workspace=null,this.$blocklyDivWrapperElement=this.$blocklyDivElement.parent(),$(window).on("resize.resizeview",this.onContainerResize.bind(this)),this.render()},onContainerResize:function(){var e=this.$blocklyDivWrapperElement.width(),t=this.$blocklyDivWrapperElement.height();this.$blocklyDivElement.width(e),this.$blocklyDivElement.height(t),this.forceBlocklySvgResize()},forceBlocklySvgResize:function(){Blockly.svgResize(this.workspace)},loadProgram:function(){this.$hiddenFileInputElement.click()},onTextLoad:function(e){this.model.importWorkspaceXml(e.target.result)},onHiddenFileInputChange:function(e){if(e.target.files.length>0){var t=e.target.files[0],o=new FileReader;o.onload=$.proxy(this.onTextLoad,this),o.readAsText(t)}}}),this.app=app||{},this.app.views=app.views||{},this.app.views.ConfigView=Backbone.View.extend({initialize:function(){this.$el.find("#sensor_hud_checkbox").change(this.changeHUDCheckbox),this.$modal=this.$el.find(".modal")},show:function(){this.$modal.modal("show")},hide:function(){this.$modal.modal("hide")},changeHUDCheckbox:function(){app.configView.hide(),app.navBarView.toggleNavbar(),$(this).is(":checked")?app.simulatorModel.enableSensorsHUD():app.simulatorModel.disableSensorsHUD()}}),this.app=app||{},this.app.views=app.views||{},this.app.views.FileSave=Backbone.View.extend({defaults:{},events:{"click .file-download-button":"onSaveButtonClick","click .file-cancel-button":"onCancelButtonClick","keypress .file-download-name-input":"onInputKeyPress"},initialize:function(){this.$fileNameInput=this.$el.find(".file-download-name-input"),this.$modal=this.$el.find(".modal")},render:function(){this.$modal.on("shown.bs.modal",function(){this.$fileNameInput.focus()})},onSaveButtonClick:function(){this.model.downloadWithFileName(this.$fileNameInput.val()),this.hide()},onInputKeyPress:function(e){13==e.which&&(e.preventDefault(),this.onSaveButtonClick())},onCancelButtonClick:function(){this.hide()},show:function(){this.$modal.modal("show")},hide:function(){this.$modal.modal("hide")}}),this.app=app||{},this.app.views=app.views||{},this.app.views.MapsSelectorView=Backbone.View.extend({initialize:function(){this.$modal=this.$el.find(".modal"),this.$el.find(".media").click(this.onMapSelectionClick)},show:function(){this.$modal.modal("show")},hide:function(){this.$modal.modal("hide")},onMapSelectionClick:function(){var e=$(this).attr("id");app.mapsSelectorView.hide(),app.navBarView.toggleNavbar(),app.blocklyModel.codeIsEmpty()?app.simulatorModel.changeMap(e):bootbox.dialog({message:"Un cambio de mapa eliminará el código existente. Querés continuar?",title:"Cambiar Mapa",buttons:{default:{label:"Cancelar",className:"btn-default"},success:{label:"Cambiar mapa",className:"btn-success",callback:function(){app.simulatorModel.changeMap(e)}}}})}}),this.app=app||{},this.app.views=app.views||{},this.app.views.NavBar=Backbone.View.extend({events:{"click .btn_run":"onClickRun","click .btn_pause":"onClickPause","click .btn_stop":"onClickStop","click .btn_save":"onClickSave","click .btn_export":"onClickExport","click .btn_load":"onClickLoad","click .btn_maps":"onClickMaps","click .btn_config":"onClickConfig"},initialize:function(){function e(e){return function(t){e(t),t.preventDefault(),t.stopPropagation()}}this.$btn_run=this.$el.find(".btn_run"),this.$btn_pause=this.$el.find(".btn_pause"),this.$btn_stop=this.$el.find(".btn_stop"),this.$btn_save=this.$el.find(".btn_save"),this.$btn_export=this.$el.find(".btn_export"),this.$btn_load=this.$el.find(".btn_load"),this.$btn_maps=this.$el.find(".btn_maps"),this.$home_navbar_collapse=$("#home-navbar-collapse"),this.$home_navbar_collapse_button=$("#home-navbar-collapse-button"),key("ctrl+g, ⌘+g",e(this.onClickSave)),key("ctrl+a, ⌘+a",e(this.onClickLoad)),key("ctrl+e, ⌘+e",e(this.onClickRun)),key("ctrl+p, ⌘+p",e(this.onClickPause)),key("ctrl+d, ⌘+d",e(this.onClickStop)),key("ctrl+m, ⌘+m",e(this.onClickMaps))},onClickConfig:function(e){app.configView.show()},onClickRun:function(e){app.simulatorModel.run($.proxy(function(){this.$btn_pause.show(),this.$btn_stop.removeClass("disabled"),this.$btn_run.hide()},this),$.proxy(function(){this.$btn_run.show(),this.$btn_pause.hide(),this.$btn_stop.addClass("disabled")},this)),e.stopPropagation()},onClickPause:function(e){app.simulatorModel.pause($.proxy(function(){this.$btn_run.show(),this.$btn_pause.hide()},this))},onClickStop:function(e){app.simulatorModel.stop($.proxy(function(){this.$btn_run.show(),this.$btn_pause.hide(),this.$btn_stop.addClass("disabled")},this))},onClickSave:function(e){app.downloadCodeView.show()},onClickExport:function(e){app.exportCodeView.show()},onClickLoad:function(e){app.blocklyView.loadProgram()},onClickMaps:function(e){app.mapsSelectorView.show()},toggleNavbar:function(){this.$home_navbar_collapse.hasClass("in")&&this.$home_navbar_collapse_button.click()},render:function(){}}),this.app=app||{},this.app.views=app.views||{},app.views.Simulator=Backbone.View.extend({initialize:function(){me.interpreter=null,game.onload("simulator-screen"),me.device.isMobile&&!navigator.isCocoonJS&&(window.document.addEventListener("touchmove",function(e){return e.preventDefault(),window.scroll(0,0),!1},!1),function(){window.scrollTo(0,1),me.video.onresize(null)}.defer(),me.event.subscribe(me.event.WINDOW_ONRESIZE,function(e){window.scrollTo(0,1)})),$(window).on("resize.resizeview",this.render.bind(this)),$(window).on("orientationchange",this.render.bind(this)),this.$screenElement=this.$el.find("#simulator-screen"),this.$canvasElement=this.$el.find("#simulator-screen > canvas"),this.render()},onContainerResize:function(){var e=this.$screenElement.parent(),t=e.width(),o=e.height(),i=Math.min(t,o),a=i;this.$screenElement.width(i),this.$screenElement.height(a),this.$canvasElement.width(i),this.$canvasElement.height(a)},enableSimulatorDragging:function(){this.$el.draggable({containment:"window"}),this.$el.draggable("enable")},disableSimulatorDragging:function(){this.$el.draggable({containment:"window"}),this.$el.draggable("disable"),this.$el.attr("style","")},resetDraggablePosition:function(){this.$el.hasClass("content-collapsed")&&(this.disableSimulatorDragging(),this.enableSimulatorDragging())},render:function(){this.onContainerResize(),this.resetDraggablePosition()}}),this.app=app||{},$(document).ready(function(){app.mapsSelectorView=new app.views.MapsSelectorView({el:"#maps-modal-wrapper"}),app.configView=new app.views.ConfigView({el:"#home-config-wrapper"}),app.navBarView=new app.views.NavBar({el:"#home-navbar-wrapper"}),app.blocklyModel=new app.models.Blockly,app.blocklyView=new app.views.Blockly({el:"#home-blockly-wrapper",model:app.blocklyModel}),app.downloadCodeModel=new app.models.FileSave({fileExtension:".xml",defaultFileName:"xml-code",extractCode:$.proxy(app.blocklyModel.exportWorkspaceXml,app.blocklyModel)}),app.downloadCodeView=new app.views.FileSave({el:"#download-code-modal-wrapper",model:app.downloadCodeModel}),app.exportCodeModel=new app.models.FileSave({fileExtension:".ino",defaultFileName:"arduino-code",extractCode:$.proxy(app.blocklyModel.exportWorkspaceArduino,app.blocklyModel)}),app.exportCodeView=new app.views.FileSave({el:"#export-code-modal-wrapper",model:app.exportCodeModel}),app.simulatorInterpreterModel=new app.models.SimulatorInterpreter,app.simulatorModel=new app.models.Simulator({interpreter:app.simulatorInterpreterModel}),app.simulatorView=new app.views.Simulator({el:"#home-simulator-wrapper",model:app.simulatorModel}),app.appView=new app.views.AppView({el:"#page-wrapper"})});
//# sourceMappingURL=../maps/app.min.js.map
